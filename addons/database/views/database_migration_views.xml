<?xml version="1.0" encoding="utf-8"?>
<ocean>
    <data>
        <!-- Database Migrations Tree View -->
        <record id="view_database_migrations_tree" model="ir.ui.view">
            <field name="name">database_migrations.tree</field>
            <field name="model">database.migration</field>
            <field name="arch" type="xml">
                <tree string="Database Migrations" decoration-muted="status=='pending'" decoration-success="status=='completed'" decoration-warning="status=='in_progress'" decoration-danger="status=='failed'">
                    <field name="name"/>
                    <field name="database_id"/>
                    <field name="migration_type"/>
                    <field name="status"/>
                    <field name="from_version"/>
                    <field name="to_version"/>
                    <field name="start_time"/>
                    <field name="end_time"/>
                    <field name="duration"/>
                    <field name="backup_before_migration"/>
                    <field name="rollback_enabled"/>
                    <field name="validation_status"/>
                    <field name="affected_records"/>
                </tree>
            </field>
        </record>
        
        <!-- Database Migrations Form View -->
        <record id="view_database_migrations_form" model="ir.ui.view">
            <field name="name">database_migrations.form</field>
            <field name="model">database.migration</field>
            <field name="arch" type="xml">
                <form string="Database Migration">
                    <header>
                        <button name="action_start_migration" string="Start Migration" type="object" class="btn-primary" attrs="{'invisible': [('status', '!=', 'pending')]}"/>
                        <button name="action_complete_migration" string="Complete Migration" type="object" class="btn-success" attrs="{'invisible': [('status', '!=', 'in_progress')]}"/>
                        <button name="action_fail_migration" string="Fail Migration" type="object" class="btn-danger" attrs="{'invisible': [('status', '!=', 'in_progress')]}"/>
                        <button name="action_cancel_migration" string="Cancel Migration" type="object" class="btn-warning" attrs="{'invisible': [('status', 'not in', ['pending', 'in_progress'])]}"/>
                        <button name="action_rollback_migration" string="Rollback Migration" type="object" class="btn-danger" attrs="{'invisible': [('status', 'not in', ['completed', 'failed'])]}"/>
                        <button name="action_validate_migration" string="Validate Migration" type="object" class="btn-info" attrs="{'invisible': [('status', '!=', 'completed')]}"/>
                        <button name="action_execute_migration" string="Execute Migration" type="object" class="btn-primary" attrs="{'invisible': [('status', '!=', 'pending')]}"/>
                        <field name="status" widget="statusbar" statusbar_visible="pending,in_progress,completed,failed,rolled_back"/>
                    </header>
                    <sheet>
                        <div class="oe_title">
                            <h1>
                                <field name="name" placeholder="Migration Name"/>
                            </h1>
                        </div>
                        
                        <group>
                            <group string="Basic Information">
                                <field name="description"/>
                                <field name="database_id"/>
                                <field name="migration_type"/>
                                <field name="status"/>
                            </group>
                            <group string="Migration Versioning">
                                <field name="from_version"/>
                                <field name="to_version"/>
                            </group>
                        </group>
                        
                        <group>
                            <group string="Migration Timing">
                                <field name="start_time"/>
                                <field name="end_time"/>
                                <field name="duration"/>
                            </group>
                            <group string="Migration Settings">
                                <field name="backup_before_migration"/>
                                <field name="backup_id"/>
                                <field name="rollback_enabled"/>
                            </group>
                        </group>
                        
                        <group>
                            <group string="Migration Validation">
                                <field name="validation_enabled"/>
                                <field name="validation_status"/>
                                <field name="validation_time"/>
                            </group>
                            <group string="Migration Impact">
                                <field name="affected_tables"/>
                                <field name="affected_records"/>
                            </group>
                        </group>
                        
                        <group>
                            <group string="Migration Scheduling">
                                <field name="is_scheduled"/>
                                <field name="scheduled_time"/>
                            </group>
                            <group string="Migration Analytics">
                                <field name="success_rate"/>
                                <field name="total_migrations"/>
                                <field name="successful_migrations"/>
                                <field name="failed_migrations"/>
                            </group>
                        </group>
                        
                        <notebook>
                            <page string="Migration Script" name="migration_script">
                                <field name="migration_script" widget="ace" options="{'mode': 'python'}"/>
                            </page>
                            
                            <page string="Rollback Script" name="rollback_script">
                                <field name="rollback_script" widget="ace" options="{'mode': 'python'}"/>
                            </page>
                            
                            <page string="Dependencies" name="dependencies">
                                <field name="depends_on" widget="many2many_tags"/>
                                <field name="required_by" widget="many2many_tags"/>
                            </page>
                            
                            <page string="Migration Results" name="results">
                                <field name="result_summary"/>
                                <field name="performance_impact"/>
                            </page>
                            
                            <page string="Migration Logs" name="logs">
                                <field name="log_file"/>
                                <field name="error_message"/>
                            </page>
                            
                            <page string="Migration Metadata" name="metadata">
                                <field name="metadata"/>
                            </page>
                        </notebook>
                        
                    </sheet>
                </form>
            </field>
        </record>
        
        <!-- Database Migrations Search View -->
        <record id="view_database_migrations_search" model="ir.ui.view">
            <field name="name">database_migrations.search</field>
            <field name="model">database.migration</field>
            <field name="arch" type="xml">
                <search string="Search Database Migrations">
                    <field name="name"/>
                    <field name="description"/>
                    <field name="database_id"/>
                    <field name="migration_type"/>
                    <field name="from_version"/>
                    <field name="to_version"/>
                    <field name="start_time"/>
                    <field name="end_time"/>
                    <filter string="Pending Migrations" name="pending" domain="[('status', '=', 'pending')]"/>
                    <filter string="In Progress Migrations" name="in_progress" domain="[('status', '=', 'in_progress')]"/>
                    <filter string="Completed Migrations" name="completed" domain="[('status', '=', 'completed')]"/>
                    <filter string="Failed Migrations" name="failed" domain="[('status', '=', 'failed')]"/>
                    <filter string="Rolled Back Migrations" name="rolled_back" domain="[('status', '=', 'rolled_back')]"/>
                    <filter string="Cancelled Migrations" name="cancelled" domain="[('status', '=', 'cancelled')]"/>
                    <filter string="Upgrade Migrations" name="upgrade" domain="[('migration_type', '=', 'upgrade')]"/>
                    <filter string="Downgrade Migrations" name="downgrade" domain="[('migration_type', '=', 'downgrade')]"/>
                    <filter string="Schema Change Migrations" name="schema_change" domain="[('migration_type', '=', 'schema_change')]"/>
                    <filter string="Data Migration" name="data_migration" domain="[('migration_type', '=', 'data_migration')]"/>
                    <filter string="Index Optimization" name="index_optimization" domain="[('migration_type', '=', 'index_optimization')]"/>
                    <filter string="Cleanup Migrations" name="cleanup" domain="[('migration_type', '=', 'cleanup')]"/>
                    <filter string="Custom Migrations" name="custom" domain="[('migration_type', '=', 'custom')]"/>
                    <filter string="Scheduled Migrations" name="scheduled" domain="[('is_scheduled', '=', True)]"/>
                    <filter string="Validated Migrations" name="validated" domain="[('validation_status', '=', 'validated')]"/>
                    <filter string="Not Validated Migrations" name="not_validated" domain="[('validation_status', '=', 'not_validated')]"/>
                    <filter string="Validation Failed Migrations" name="validation_failed" domain="[('validation_status', '=', 'validation_failed')]"/>
                    <group expand="0" string="Group By">
                        <filter string="Database" name="group_database" context="{'group_by': 'database_id'}"/>
                        <filter string="Migration Type" name="group_migration_type" context="{'group_by': 'migration_type'}"/>
                        <filter string="Status" name="group_status" context="{'group_by': 'status'}"/>
                        <filter string="Start Time" name="group_start_time" context="{'group_by': 'start_time:day'}"/>
                        <filter string="End Time" name="group_end_time" context="{'group_by': 'end_time:day'}"/>
                    </group>
                </search>
            </field>
        </record>
        
        <!-- Database Migrations Action -->
        <record id="action_database_migrations" model="ir.actions.act_window">
            <field name="name">Database Migrations</field>
            <field name="res_model">database.migration</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="view_database_migrations_tree"/>
            <field name="search_view_id" ref="view_database_migrations_search"/>
            <field name="context">{'search_default_completed': 1}</field>
        </record>
        
    </data>
</ocean>